import {IComponentTest} from "./IComponentTest";

const TestUtils  = require("../../../test-utils");

import {jasmine} from "jasmine-core/lib/jasmine-core/example/spec";
const BlueBuy = require("../buy-button");
import Spy = jasmine.Spy;

export class BuyButtonTest implements IComponentTest {

    public numberOfClicks = 3;
    public spy: Spy = jasmine.createSpy();

    constructor() {
    }

    public async act() {
        const shadowRoot = await TestUtils.render(BlueBuy.tag);
        const buyButton = shadowRoot.querySelector("button");
        for (let clickCount = 1; clickCount <= this.numberOfClicks; clickCount++) {
            buyButton.click();
        }
    }

    public async arrange() {
        window.addEventListener("blue:basket:changed", this.spy);
    }

    public assert = async () => {
        expect(this.spy.calls.count()).toEqual(this.numberOfClicks);
    }
}
